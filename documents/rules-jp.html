<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="samuraidocs.css" >
    <title>SamurAI Dig Here 2020 ゲームルール (暫定版)</title>
  </head>
  <body>
    <span style="float:left">
      <a href="rules.html" target="_blank">English</a>
    </span>
    <h1>SamurAI Dig Here 2020 ゲームルール (暫定版)</h1>
    <center>
      <p>
	情報処理学会プログラミングコンテスト委員会<br>
	<x-edited>2020/?/?</x-edited>
      </p>
      <div style="width:70%">
	<p>
	  この文書は情報処理学会主催の <em>SamurAI Coding 2020-21</em>
	  コンテストの対象である <em>SamurAI Dig Here 2020</em>
	  ゲームのルールを述べるものである.
	</p>
	<p>
	  本文書は暫定版であり, 今後の改訂の可能性がある.
	</p>
      </div>
    </center>

    <h2>ゲームの概要</h2>
    <p>
      ゲームは 2 チーム間で競う零和不完全情報ゲーム,
      競技参加者によるプログラムで制御する各 2 エージェントが競い合うものである.
      ゲームの目的は競技の場に隠されている埋蔵金をより多く掘り出すことである.
    </p>

    <img src="screenShots/small-field.png" width="50%" class="figure">
    <h3>競技場</h3>
    <p>
      競技場は正方形で,
      正方格子状に並ぶ小正方形 (<em>セル</em>) に分かれている.
      競技場のサイズ, すなわち競技場の一辺に並ぶセルの数はゲームごとに異なる.
      最小サイズは 6 である.
    </p>
    <p>
      右図は正方形の競技場を斜め方向から俯瞰したものである.
    </p>

    <h3>ゲームエージェント</h3>
    <p>
      両チームにはそれぞれ 2 体のゲームエージェント,
      <em>侍</em>と<em>犬</em>がある.
    </p>
    <p>
      ゲームエージェントは競技者が提供するプログラムで制御する.
      同じチームの犬と侍は同じプログラムが動くふたつのプロセスで制御し,
      両プロセス間の通信はゲーム管理システムを介したものだけで,
      他の通信手段はない.
    </p>
    <p>
      ゲーム開始時にはエージェントは競技場内の別々のセル上にある.
      ゲームを通して複数のエージェントが同時に同じセル上に来ることはない.
    </p>
    <p>
      ゲームの 1 ステップごとに, 侍エージェントはその 4 近傍セル,
      すなわち現在のセルと 4 辺のいずれかを共有するセルに動くことができる.
      犬エージェントは 8 近傍セル,
      すなわち現在のセルと 4 隅のひとつかふたつを共有するセルに動くことができる.
      現在のセルから動かないこともできる.
    </p>
    <p>
      ふたつ以上のエージェントが同じセルに動くよう指示された場合,
      いずれも動くことはできず, 元の位置に留められる.
    </p>

    <h3>穴</h3>
    <p>
      競技場内のセルには<em>穴</em>があることもあり,
      そこにはエージェントは動けない.
      侍エージェントは動く代わりに, 4 近傍セルのひとつにある穴を埋めることができる.
      また, 侍は 4 近傍セルのひとつに新たな穴を掘ることもできる.
      ただし,
      ステップ開始時に既に他のエージェントがいたり,
      掘ろうとする同じステップで他のエージェントが動いてきたセルには穴を掘れない.
    </p>
    <p>
      エージェントの初期位置に穴はない.
    </p>

    <h3>埋蔵金</h3>
    <p>
      競技場内のセルには<em>埋蔵金</em>が埋められていることがある.
      埋蔵金のあるセルに穴を掘ると, 埋蔵金を掘り出すことができる.
      両チームの侍が同時に同じセルに穴を掘った場合は,
      埋蔵金は両チームが半分ずつ獲得することになる.
      なお, 埋蔵金の量は常に偶数である.
    </p>
    <p>
      犬は埋蔵金のあるセルの 8 近傍セルに来ると,
      埋蔵金の位置と量を感知することができる.
      その情報は他のエージェントには伝えられない.
      犬が埋蔵金のあるセルそのものに来ると, 犬は吠え,
      埋蔵金の位置と量とは全エージェントの知るところとなる.
      同じチームの侍だけでなく, 相手チームの侍や犬にも吠え声は聞こえてしまう.
    </p>
    <p>
      エージェントの初期位置や穴のあるセルには埋蔵金がない.
    </p>

    <h3>ゲームのステップ</h3>
    <p>
      ゲームはステップ単位で進行する.
      ステップ開始にあたって,
      全エージェントは同時にそのステップの<em>プレイプラン</em>を立てる.
      全エージェントのプランの有効性や衝突をチェックして, 
      各エージェントの<em>行動</em>を決定する.
      決定した行動にしたがって競技の状態を更新する.
    </p>
    <p>
      ステップ数があらかじめ決めた最大値に達するか,
      すべての埋蔵金が掘り尽くされるまで,
      このゲームステップを繰り返す.
    </p>

    <h2>プレイヤプログラム</h2>
    <h3>プレイヤプロセス</h3>
    <p>
      競技参加者は自チームのふたつのエージェント,
      侍と犬を制御する<em>プレイヤプログラム</em>を用意する.
    </p>
    <p>
      ゲームの開始に当たってゲーム管理システムは,
      両チームについてふたつの<em>プレイヤプロセス</em>を起動する.
      各チームふたつのプレイヤプロセスは同じプログラムを実行するが,
      ひとつは侍を, ひとつは犬を制御する.
      制御するエージェントは起動後にゲーム管理システムから通知される.
    </p>
    <p>
      プレイヤプロセス同士の通信はゲーム管理システムを介したものだけで,
      直接通信することはできない.
    </p>

    <h3>入出力</h3>
    <p>
      ステップの開始時にゲーム管理システムはゲーム状態情報を各プレイヤプロセスに送る.
      プレイヤプロセスはこれを受け取って,
      担当するエージェントのプレイプランを返答しなければならない.
    </p>
    <p>
      プレイヤプロセスはゲーム管理システムからのゲーム状態情報は標準入力から読み込む.
      これに対する返答のプレイプランは標準出力に書き出す.
    </p>

    <h3>プレイプランと行動</h3>
    <p>
      <em>プレイプラン</em>は各プレイヤプログラムが送ったエージェントの動作案で,
      <em>行動</em>はゲーム管理システムがそれらを照合して調整した結果,
      実際に各エージェントがとる動作である.
    </p>
    <p>
      プレイプランや行動は以下の意味を持つ整数値 <var>m</var> (-1
      &leq; <var>m</var> &leq; 23) で表す.
      <div class="figure">
	<table class="bordered">
	  <tr>
	    <th></th>
	    <th><var>x</var>&minus;1</th>
	    <th><var>x</var></th>
	    <th><var>x</var>&plus;1</th>
	  </tr>
	  <tr>
	    <th><var>y</var>&minus;1</th>
	    <td>3</td><td>4</td><td>5</td>
	  </tr>
	  <tr>
	    <th><var>y</var></th>
	    <td>2</td><td></td><td>6</td>
	  </tr>
	  <tr>
	    <th><var>y</var>&plus;1</th>
	    <td>1</td><td>0</td><td>7</td>
	  </tr>
	</table>
	<center>
	  <caption>対象セル</caption>
	</center>
      </div>
      <dl>
	<dt>&minus;1</dt>
	<dd>現在位置に留まり, 何もしない.</dd>
	<dt>0, &hellip;, 7</dt>
	<dd>近傍セルのいずれかに動く.</dd>
	<dt>8, &hellip;, 15</dt>
	<dd>近傍セルのいずれかに穴を掘る.</dd>
	<dt>16, &hellip;, 23</dt>
	<dd>近傍セルのいずれかの穴を埋める.</dd>
      </dl>
      動いたり穴掘りや穴埋めをする対象セルの座標は
      <var>d</var> &equals; <var>m</var> modulo 8
      によって決まる.
      その意味は右図に示すとおりである.
    </p>
    <p>
      通常, 侍の移動や穴掘り穴埋めの対象は 4 近傍セルのいずれかで,上述
      の <var>d</var> は偶数でなければならない. 侍のプレイプランが 23
      以下の非負の偶数でも &minus;1でもなければ, それは<em>不正</em>で
      ある. ただし, ゲーム開始時の最初のステップと, プレイプランが
      &minus;1 (何もしないで休憩) だったステップの直後のステップは例外
      で,その侍は斜め方向も含めた 8 近傍セルのすべてに対して移動や穴掘
      り穴埋めができる.
    </p>
    <p>
      犬は穴掘り, 穴埋めができない. 犬のプレイプランが &minus;1 以上 7
      以下の整数でなければ<em>不正</em>である.
    </p>
    <p>
      不正なプレイプランは &minus;1 (休憩) と同様に扱う.
      当該エージェントの行動が &minus;1 になるだけでなく,
      後述するゲーム状態情報にもプレイプラン
      &minus;1 を指定したものとして扱う <a href="#invalid plan">[1]</a>.
      このため, 不正なプレイプランを指定したステップの直後のステップでも,
      侍は斜め方向の移動や穴掘り穴埋めができる.
    </p>
    <p>
      一方, セルの状態やエージェントの位置や動きのために,
      プレイプラン通りの動きができない場合,
      そのプレイプランは<em>無効</em>であるという.
    </p>
    <p>
      競技場外の方向へ移動, 穴掘り, 穴埋めは無効である.
      穴があるセルの穴掘り, 穴のないセルの穴埋めも無効である.
      ステップ開始時に他のエージェントがいるセルへの移動や穴掘り・穴埋めも無効である.
    </p>
    <p>
      同一ステップでの同一セルへの複数のエージェントの移動は,
      すべてが無効になる.
      同一ステップで他のエージェントが移動してくるセルの穴掘りも無効である.
      しかし, 複数のエージェントが同一セルに移動しようとして移動が無効になれば,
      別のエージェントによるそのセルへの穴掘りは有効になる.
    </p>
    <div class="figure" style="width:13%; margin:1%">
      <img src="diagonal.png" width="100%">
      <center>
	<caption>斜め方向動作</caption>
      </center>
    </div>
    <p>
      斜め方向への移動の動線や穴掘り・穴埋めの方向が互いに交差する場合,
      両者のプレイプランは共に無効となる.
      ただし，侍と犬の斜め移動の動線が交差する場合は例外で,
      犬のプレイプランだけが無効，侍のプレイプランは有効になる.
    </p>
    <p>
      右図で A から D, B から C の移動あるいは穴掘り・穴埋めのプラン，
      すなわち A にいるエージェントがプラン 7, 15, 23 のいずれか,
      B にいるエージェントがプラン 1, 9, 17 のいずれかを指定したとする．
      この組合せのうち有効になるプランは,
      A に直前のステップに休憩をとった侍,
      B に犬がいるときの侍のプラン 7 と,
      逆に直前のステップに休憩をとった侍が B に,
      犬が A がいるときの侍のプラン 1 のみで,
      残りはすべて無効になる.
    </p>
    <p>
      無効なプレイプランに対する行動も &minus;1 を指定したと同様になるが,
      不正なプレイプランとは異なり,
      プレイプラン自体は後述するゲーム状態情報に反映される.
      したがって, プレイプランとして休憩を指定した場合と異なり,
      無効なプレイプランを指定した直後のステップでは,
      侍の斜め方向の移動・穴掘り・穴埋めが不正となる．
    </p>

    <h3>ゲーム状態情報</h3>
    <p>
      各ステップの開始時に,
      ゲーム管理システムからプレイヤプロセスに<em>ゲーム状態情報</em>を送る.
      ゲーム状態情報は以下の各項目がこの順に並ぶものである.
      <ul>
	<li>
	  この情報を受け取るプレイヤプロセスが制御するエージェント番号.
	  一方の侍が 0, 他方の侍が 1, 0 番の侍と同じチームの犬が 2,
	  他方の 犬が 3 である.
	</li>
	<li>
	  競技場のサイズ, すなわち競技場の一辺のセル数 (整数値).
	</li>
	<li>
	  現在のステップ番号 (整数値).  ステップ番号は 0 から始める.
	<li>
	  最大ステップ番号 (整数値).
	</li>
	<li>
	  穴のあるセルの位置のリスト.
	</li>
	<li>
	  全エージェントに知られている (公知の) 埋蔵金のリスト.
	  既に掘り出された埋蔵金は含まない.
	</li>
	<li>
	  制御するエージェントが犬である場合,
	  その位置の 8 近傍セルにある公知になっていない埋蔵金のリスト.
	  エージェントが侍ならば空リスト.
	</li>
	<li>
	  各エージェントの位置 (エージェント番号順).
	</li>
	<li>
	  直前ステップでの各エージェントのプレイプラン
	  (エージェント番号順).
	  上述の通り不正なプレイプランについては &minus;1 になる.
	  ゲーム開始時のステップではすべて &minus;1 になる.
	</li>
	<li>
	  直前のステップで各エージェントが実際にとった行動 (エージェント番号順).
	  ゲーム開始時のステップではすべて &minus;1 になる.
	</li>
	<li>
	  スコア, すなわち,
	  両軍それぞれが直前ステップにまでに掘り出した埋蔵金の総量
	  (整数値ふたつ).
	  エージェント 0, 2 のチームのスコアが先, 1, 3 のスコアが後に来る.
	</li>
	<li>
	  まだ掘り出されていない埋蔵金の総量 (整数値).
	</li>
	<li>
	  残る<a href="#timeLimit">考慮時間</a>
	  (ミリ秒単位の整数値).
	</li>
      </ul>
    </p>
    <p>
      ゲーム状態情報の要素はすべて整数である.
      前述の箇条書の各項目の間は改行で区切り,
      項目内の整数の間は空白で区切る.
      最後の要素の後には改行が置かれる.
    </p>
    <p>
      上述の項目で<em>リスト</em>と記したものは,
      先頭にリスト要素の個数 (整数値) が来る.
      リストが空なら 0 である.
      その後にリストの各要素の記述が続く.
      各要素はひとつ以上の整数値である.
    </p>
    <p>
      位置はセルのx-座標とy-座標のふたつ組で表す.
      座標値は非負整数で, 競技場のサイズより小さい.
      埋蔵金は整数値みっつで表す.
      最初のふたつは埋蔵金のあるセルの座標で, みっつ目は埋蔵金の量である.
      埋蔵金の量は必ず非負の偶数である.
    </p>
    <div class="exampleText">
      <table class="shrunk">
	<tr><td><tt>3</tt></td><td>// エージェントの番号</td></tr>
	<tr><td><tt>10</tt></td><td>// 競技場のサイズ</td></tr>
	<tr><td><tt>1</tt></td><td>// ステップ番号</td></tr>
	<tr><td><tt>100</tt></td><td>// 最大ステップ番号</td></tr>
	<tr><td><tt>6 5 1 7 3 7 0 8 1 6 0 5 2</tt></td>
	  <td>// 穴のあるセルの位置のリスト</td></tr>
	<tr><td><tt>1 6 6 6</tt></td><td>// 公知の埋蔵金</td></tr>
	<tr><td><tt>1 2 7 8</tt></td><td>// 感知した埋蔵金</td></tr>
	<tr><td><tt>9 6 2 4 5 3 1 6</tt></td><td>// エージェントの位置</td></tr>
	<tr><td><tt>0 0 7 7</tt></td><td>// 直前ステップでのプレイプラン</td></tr>
	<tr><td><tt>0 0 7 7</tt></td><td>// 直前ステップでの行動</td></tr>
	<tr><td><tt>0 0</tt></td><td>// スコア</td></tr>
	<tr><td><tt>50</tt></td><td>// 残る埋蔵金</td></tr>
	<tr><td><tt>299941</tt></td><td>// 残る考慮時間</td></tr>
      </table>
    </div>
    <p>
      ゲーム状態情報の例を右図に示す.
      "//" から以降はここでの説明のためのもので,
      実際にプレイヤプロセスには送られない.
      <ul>
	<li>
	  この情報の送り先のプレイヤ番号は 3, つまり片方のチームの犬である.
	</li>
	<li>
	  競技場は 10&times;10 のセルからなる.
	</li>
	<li>
	  ステップ番号は 1.
	</li>
	<li>
	  最大ステップ番号は 100.
	</li>
	<li>
	  穴のあるセルは 6 箇所で, その座標は (5, 1), (7, 3), (7, 0),
	  (8, 1), (6, 0), (5, 2) である.
	</li>
	<li>
	  公知の埋蔵金が (6, 6) にあり, その量は 6 である.
	</li>
	<li>
	  この情報を受ける犬は (2, 7) にある埋蔵量 8 の埋蔵金を感知した.
	</li>
	<li>
	  4 エージェントの位置は (9, 6), (2, 4), (5, 3), (1, 6) である.
	</li>
	<li>
	  直前ステップでの各エージェントのプレイプランは 0, 0, 7, 7 だった.
	  侍エージェントのプレイプランはどちらも &minus;1 ではないので,
	  両者ともこのステップでの斜め方向への移動や穴掘り穴埋めは不正になる.
	</li>
	<li>
	  直前ステップで各エージェントが実際にとった行動も 0, 0, 7, 7,
	  つまりすべてプレイプランどおりだった.
	</li>
	<li>
	  掘り出した埋蔵金はまだない.
	</li>
	<li>
	  残る埋蔵金の総量は 50 である.
	</li>
	<li>
	  このエージェントの残り考慮時間は 299941 ミリ秒である.
	</li>
      </ul>
    </p>

    <h3>プレイプラン</h3>
    <p>
      プレイヤプログラムはゲーム状態情報を読んだら,
      それに応じて対応するエージェントのプレイプランを出力する.
      プレイプランは整数値ひとつで, その意味は上述のとおりである.
      プレイプランの後には改行がなくてはならない.
    </p>

    <h3 id="timeLimit">考慮時間制限</h3>
    <p>
      プレイヤプロセスの考慮時間には制限が設けられる.
      考慮時間とはゲーム管理システムがプレイヤプロセスにゲーム状態情報を送ってから,
      その返答であるプレイプランを受け取るまでの時間のことである.
      これは実際の経過時間であって CPU 時間ではないことに注意.
      各ステップの考慮時間は累積され, その総計に対して制限が課せられる.
    </p>
    <p>
      考慮時間制限はプレイヤプロセスごとに設ける.
      同じチームの侍と犬の考慮時間は別々に累積される.
    </p>
    <p>
      考慮時間制限を越えたプレイヤプロセスは,
      その後の全ステップにおいて &minus;1 (その場に留まること)
      をプレイプランとして選択したものとみなされる.
    </p>
    <p>
      考慮時間制限の値はゲームごとに定める.
    </p>

    <h2>試合</h2>
    <p>
      2 チームの間の試合は,
      同じ初期状態でエージェントの配置だけを交換した 2 ゲームで競う.
      試合の勝敗は 2 ゲームを通じて掘り出した埋蔵金の総量で判定する.
    </p>
    <hr>
    <ul class="footnotes">
      <li id="invalid plan">
	不正なプレイプランをそのままゲーム状態情報に反映すると,
	エージェント同士の自由な通信ができてしまうため.
      </li>
    </ul>
  </body>
</html>
